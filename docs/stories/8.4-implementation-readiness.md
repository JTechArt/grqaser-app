# Implementation Readiness: Story 8.4

**See also:** [Implementation readiness for all stories](./implementation-readiness-all-stories.md).

**Story:** 8.4 — Library: auto-add on open, manual remove  
**Checked by:** Architect (Winston)  
**Date:** 2026-02-19

## Verdict: **READY**

The story is implementation-ready for the Dev agent. It changes Library behavior to auto-add books when opened and allows manual removal, building on Story 8.1's local SQLite infrastructure. All referenced architecture docs, design mockups, data models, and source paths exist. Tasks are clear and well-sequenced.

---

## 1. Architecture and reference integrity

| Check | Status | Notes |
|-------|--------|--------|
| All cited architecture docs exist | ✅ | grqaserapp-data-integration-and-audio (Library behavior), data-models-and-schema (library_entries), source-tree, tech-stack, testing-and-deployment-strategy — all exist and updated for Epic 8 |
| Dev Notes match architecture content | ✅ | Auto-add on open, manual remove, re-open re-adds, upsert behavior — all match architecture |
| Source references accurate | ✅ | `[Source: architecture/...]` and `[Source: docs/design/...]` point to real sections |
| Phase scope correct | ✅ | Epic 8; prerequisite: Story 8.1 complete; 8.2 recommended for "Downloaded" filter pill |

---

## 2. File and project structure

| Check | Status | Notes |
|-------|--------|--------|
| New `librarySlice.ts` | ✅ | Path `src/state/slices/librarySlice.ts` — slices/ exists; file to be created |
| Modified `appMetaRepository.ts` | ✅ | Created by 8.1; this story adds `library_entries` table CRUD |
| Modified `BookDetailScreen.tsx` | ✅ | Exists; this story adds auto-add dispatch on mount |
| Modified `LibraryScreen.tsx` | ✅ | Exists; this story updates to show library entries with remove and filter pills |
| Design mockup | ✅ | `docs/design/grqaser-app/library.html` — present with library layout, filter pills, remove button |

---

## 3. Acceptance criteria and tasks

| AC | Covered by tasks | Notes |
|----|------------------|--------|
| AC1: Auto-add on book open | Tasks 1, 2, 3 | library_entries table upsert; librarySlice async thunk; BookDetailScreen dispatch on mount |
| AC2: Manual remove | Tasks 1, 2, 4 | removeFromLibrary() deletes row; librarySlice action; LibraryScreen remove button |
| AC3: Re-open adds back | Tasks 1, 3 | Upsert behavior in addToLibrary — insert or update last_opened_at; consistent re-add |
| AC4: Consistent with existing behavior | Tasks 4, 5 | Library list with metadata from catalogRepository; filter pills; tests and smoke test |

---

## 4. Technical constraints

- **Dependency on 8.1:** Story explicitly requires appMetaRepository, catalogRepository, and LibraryEntry TypeScript type from Story 8.1.
- **"Downloaded" filter pill:** Depends on `downloadSlice` from Story 8.2. Story correctly notes this can be stubbed/disabled if 8.2 is not done — not a blocker.
- **Library currently shows `recentlyPlayed` from booksSlice:** Story 8.4 replaces this with `library_entries` driven by auto-add. Dev should ensure `recentlyPlayed` behavior is migrated or removed as appropriate.
- **Upsert for addToLibrary:** Story specifies upsert (INSERT OR REPLACE / ON CONFLICT UPDATE); `react-native-sqlite-storage` supports standard SQL — straightforward.

---

## 5. Summary

- **Implementation readiness:** **GO** — Story 8.4 is ready for the Dev agent.
- **Dependency:** Story 8.1 complete. Story 8.2 recommended for "Downloaded" filter pill but not required.
- **No blocking gaps.** All refs, paths, mockups, and schemas verified. Library auto-add/remove flow is well-specified with upsert behavior and clear UI reference.
