# Story 7.1: Verify books-admin-app functional parity

## Status

Ready for Review

## Story

**As a** product owner / developer,  
**I want** to confirm that books-admin-app delivers the same capabilities as the original crawler and database-viewer (per Epic 1 and Epic 2),  
**so that** we can safely remove the legacy applications without losing functionality.

## Acceptance Criteria

1. **Crawler parity:** All Epic 1 behaviors are available via books-admin-app: metadata and audio URL extraction, full catalog and pagination, search/categories/authors, data cleaning and schema (crawler runs from app per 6.3; config and active DB per 6.2).
2. **Database-viewer parity:** All Epic 2 behaviors are available: books API (list, by id, search), stats API (overview, authors, categories), crawler status API and health, web UI for books/stats and crawler monitoring (plus 6.2 DB versioning and 6.4 view/edit).
3. Parity is documented (e.g. mapping Epic 1/2 ACs to books-admin-app features) and signed off so Epic 5 verification and Epic 7 removal can proceed.

## Tasks / Subtasks

- [x] Task 1: Crawler parity verification (AC: 1)
  - [x] Produce a parity document mapping each Epic 1 story/AC to the corresponding books-admin-app feature or behavior ([Source: docs/architecture/books-admin-app-architecture.md], [Source: docs/architecture/crawler-pipeline-and-data-contract.md]).
  - [x] Verify metadata and audio URL extraction (Epic 1.1) are available via books-admin-app crawler (same pipeline; crawler runs from app per Story 6.3).
  - [x] Verify full catalog and pagination (Epic 1.2), search/categories/authors (Epic 1.3), and data cleaning/validation/schema (Epic 1.4) are available; config and active DB are managed per Stories 6.2 and 6.3.
  - [x] Record where each Epic 1 behavior is implemented or invoked in books-admin-app (e.g. routes, crawler module, config, active DB path).
- [x] Task 2: Database-viewer parity verification (AC: 2)
  - [x] Produce a parity document mapping each Epic 2 story/AC to the corresponding books-admin-app API or web UI ([Source: docs/architecture/books-admin-app-architecture.md], [Source: docs/architecture/database-viewer-api-and-deployment.md]).
  - [x] Verify books API (GET /api/v1/books, GET /api/v1/books/:id, GET /api/v1/books/search), stats API (overview, authors, categories), crawler status API and health (e.g. /api/v1/crawler/status, /api/v1/health) are present and read from active DB.
  - [x] Verify web UI provides dashboard, book list (filters, search, detail), crawler monitoring; plus DB versioning (6.2) and data view/edit (6.4).
  - [x] Record where each Epic 2 behavior is implemented (routes, public UI, active DB usage).
- [x] Task 3: Parity document and sign-off (AC: 3)
  - [x] Consolidate Epic 1 and Epic 2 mappings into a single parity document (e.g. `docs/parity-books-admin-app.md` or under `docs/architecture/`) with clear AC-to-feature mapping and references to books-admin-app code or endpoints.
  - [x] Add a sign-off section (who verified, date, and approval that parity is sufficient for Epic 5 verification and Epic 7.2 removal).
  - [x] Ensure document is referenced from delivery order or Epic 7 so runbooks and Epic 5 refer to books-admin-app as the single admin entrypoint.

## Dev Notes

### Purpose

Story 7.1 is **verification and documentation**, not new feature implementation. The goal is to confirm that books-admin-app (Epic 6) delivers all behaviors previously provided by the standalone crawler (Epic 1) and database-viewer (Epic 2), and to document that mapping with sign-off so that Epic 5 verification and Story 7.2 (removal of crawler and database-viewer) can proceed safely ([Source: docs/architecture/delivery-order-and-application-boundaries.md]).

### Previous Story Insights

- Story 6.4 completed data view and edit (active DB, PATCH /api/v1/books/:id, edit form, last_edited_at). books-admin-app now has full data management; parity doc should list 6.2 (DB versioning) and 6.4 (view/edit) as part of “database-viewer parity” where they extend the original viewer ([Source: docs/stories/6.4.data-management-view-and-edit.md]).

### Epic 1 (Crawler) Behaviors to Map

- **1.1:** Metadata and audio URLs — duration parsed, audio URLs validated and stored; categories, ratings, descriptions, language; schema documented ([Source: docs/prd/epic-1.md]).
- **1.2:** Full catalog and pagination — listing/detail pagination, rate limiting, full target catalog, duplicates avoided; progress/errors loggable ([Source: docs/prd/epic-1.md], [Source: docs/architecture/crawler-pipeline-and-data-contract.md]).
- **1.3:** Search and categories/authors — search flow, categories/authors extracted and linked; relationships for filtering and stats ([Source: docs/prd/epic-1.md]).
- **1.4:** Data cleaning, validation, schema — text cleaned (no HTML), validation before write, schema documented and versioned, writes to SQLite ([Source: docs/prd/epic-1.md], [Source: docs/architecture/crawler-pipeline-and-data-contract.md]).

Crawler behavior in books-admin-app: runs from app (Story 6.3 start/stop and config); uses active DB (Story 6.2); same pipeline and config as documented in [Source: docs/architecture/crawler-pipeline-and-data-contract.md] and [Source: docs/architecture/books-admin-app-architecture.md].

### Epic 2 (Database-viewer) Behaviors to Map

- **2.1:** Books API (list, by id, search), stats API (overview, authors, categories) ([Source: docs/prd/epic-2.md], [Source: docs/architecture/database-viewer-api-and-deployment.md]).
- **2.2:** Crawler status API and health — e.g. /api/v1/crawler/status, /urls, /logs; GET /api/v1/health; config externalized ([Source: docs/prd/epic-2.md]).
- **2.3:** Web UI — dashboard, book list (filters, search, detail), crawler status/logs view; desktop responsive ([Source: docs/prd/epic-2.md]).

Additional in books-admin-app: DB versioning (6.2) and data view/edit (6.4) ([Source: docs/architecture/books-admin-app-architecture.md]).

### File Locations

- **Parity document:** Create under `docs/` (e.g. `docs/parity-books-admin-app.md`) or `docs/architecture/` (e.g. `docs/architecture/parity-books-admin-app.md`) per project convention. No specific path mandated in source tree for this doc ([Source: docs/architecture/source-tree.md]).
- **books-admin-app:** Entry `books-admin-app/src/server.js`; routes in `src/routes/` (books, stats, crawler, databases, health); crawler in `src/crawler/` or subprocess; config and active DB in `src/config/` ([Source: docs/architecture/books-admin-app-architecture.md]).

### Technical Constraints

- No code changes to books-admin-app are required unless gaps are found; if gaps are found, they are documented and either fixed in this story or logged as blockers for 7.2.
- Data contract and schema remain as for Epic 6 ([Source: docs/architecture/delivery-order-and-application-boundaries.md]).

### Testing

- Verification is manual or scripted checks against books-admin-app (run app, call APIs, use web UI). No new unit/integration test suite is required for “parity” itself; existing books-admin-app and Epic 5 tests validate behavior ([Source: docs/architecture/testing-and-deployment-strategy.md]). Optional: add a short checklist or script that runs through the parity list and records pass/fail.

## Change Log

| Date       | Version | Description                    | Author       |
|-----------|---------|--------------------------------|--------------|
| 2025-02-17 | 1.0     | Story created from Epic 7      | Scrum Master |
| 2025-02-17 | 1.1     | Parity doc created; Tasks 1–3 complete; architecture refs added | Dev Agent   |

## Dev Agent Record

### Agent Model Used

Auto (Cursor)

### Debug Log References

- Verified books-admin-app routes and models against Epic 1/2 ACs via code read (server.js, routes/books.js, routes/stats.js, routes/crawler.js, routes/databases.js, models/database.js, models/db-registry.js, services/crawler-runner.js, config.js, public/index.html). No automated test run required per story (verification is manual or scripted; optional checklist included in parity doc).

### Completion Notes List

- Created `docs/parity-books-admin-app.md` with full Epic 1 and Epic 2 AC-to-feature mapping, implementation locations (files/routes), optional verification checklist, and sign-off section.
- Crawler parity: Epic 1 behavior is delivered via crawler subprocess (grqaser-crawler from `crawler/`); books-admin-app invokes it via `crawler-runner.js` with active DB from `db-registry` and config from `crawler-config-store`; API/UI read from active DB.
- Database-viewer parity: All Epic 2 APIs and web UI are in books-admin-app (routes, models, public/index.html); DB versioning (6.2) and data edit (6.4) documented as part of viewer parity.
- Referenced parity document from `docs/architecture/index.md` and `docs/architecture/delivery-order-and-application-boundaries.md` so runbooks and Epic 5 refer to books-admin-app and the parity mapping.

### File List

- `docs/parity-books-admin-app.md` (new)
- `docs/architecture/index.md` (modified — added parity doc reference)
- `docs/architecture/delivery-order-and-application-boundaries.md` (modified — added parity doc link in Story 7.1 bullet)

## QA Results

_(Populated by QA agent)_
