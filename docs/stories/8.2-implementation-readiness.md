# Implementation Readiness: Story 8.2

**See also:** [Implementation readiness for all stories](./implementation-readiness-all-stories.md).

**Story:** 8.2 — MP3 download storage and offline playback cleanup  
**Checked by:** Architect (Winston)  
**Date:** 2026-02-19

## Verdict: **READY**

The story is implementation-ready for the Dev agent. It adds MP3 download/offline playback and cleanup, building on the local SQLite infrastructure from Story 8.1. All referenced architecture docs, design mockups, data models, and source paths exist. Tasks are well-sequenced with clear service/repository/slice boundaries.

---

## 1. Architecture and reference integrity

| Check | Status | Notes |
|-------|--------|--------|
| All cited architecture docs exist | ✅ | grqaserapp-data-integration-and-audio (MP3 download section), data-models-and-schema (downloaded_mp3s), source-tree, tech-stack, coding-standards, testing-and-deployment-strategy — all exist and updated for Epic 8 |
| Dev Notes match architecture content | ✅ | Download manager, downloaded_mp3s table, offline playback, cleanup — all match architecture |
| Source references accurate | ✅ | `[Source: architecture/...]` and `[Source: docs/design/...]` point to real sections |
| Phase scope correct | ✅ | Epic 8; prerequisite: Story 8.1 complete |

---

## 2. File and project structure

| Check | Status | Notes |
|-------|--------|--------|
| New `downloadManager.ts` | ✅ | Path `src/services/downloadManager.ts` — services/ exists; file to be created |
| New `downloadSlice.ts` | ✅ | Path `src/state/slices/downloadSlice.ts` — slices/ exists; file to be created |
| Modified `appMetaRepository.ts` | ✅ | Created by 8.1; this story adds `downloaded_mp3s` table CRUD |
| Modified `playerService.ts` / `playbackService.ts` | ✅ | Both exist in `src/services/` |
| Modified screens | ✅ | `BookDetailScreen.tsx`, `LibraryScreen.tsx`, `SettingsScreen.tsx` — all exist |
| Design mockups | ✅ | `docs/design/grqaser-app/book-detail.html` (download button), `library.html` (downloaded badge), `profile.html` (cleanup section) — all present |

---

## 3. Acceptance criteria and tasks

| AC | Covered by tasks | Notes |
|----|------------------|--------|
| AC1: Storage allocation | Tasks 1, 2, 3 | downloadManager allocates per-book directories; downloaded_mp3s table tracks files; downloadSlice tracks state |
| AC2: Download MP3s for books | Tasks 1, 3, 5 | downloadManager handles multi-chapter and single-file; BookDetailScreen has download button with progress |
| AC3: Offline use | Task 4 | playerService checks local file before streaming; offline message when unavailable |
| AC4: Cleanup in Settings | Task 7 | SettingsScreen shows downloaded books list with per-book clean and clean-all |
| AC5: Fallback after cleanup | Tasks 4, 7 | Cleanup triggers state update; player falls back to streaming or shows offline message |

---

## 4. Technical constraints

- **Dependency on 8.1:** Story explicitly requires local SQLite infrastructure (database/, appMetaRepository, databaseSlice, TypeScript types) from Story 8.1.
- **File system access:** `react-native-fs` or `expo-file-system` (added in 8.1) — same dependency, no additional install.
- **Audio URL sources:** Story correctly distinguishes `main_audio_url` (single-file) vs `chapter_urls` JSON array (multi-chapter) with `has_chapters` flag — matches books table schema.
- **Background downloads:** Story notes "where platform allows" — appropriate caveat for iOS/Android differences.
- **Network detection:** Story requires offline state detection — dev will need `@react-native-community/netinfo` or equivalent (not explicitly listed in tech-stack but standard RN dependency). Minor gap, not blocking.

---

## 5. Summary

- **Implementation readiness:** **GO** — Story 8.2 is ready for the Dev agent.
- **Dependency:** Story 8.1 complete.
- **Minor note:** Network state detection library not explicitly in tech-stack; dev should add `@react-native-community/netinfo` or equivalent. Not a blocker.
- All refs, paths, mockups, and schemas verified. Download/cleanup/offline flows are well-specified with clear data model and UI references.
