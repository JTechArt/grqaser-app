# Story 9.2: Player Speed Control

## Status

Draft

## Story

**As a** mobile user listening to audiobooks,
**I want** playback speed controls on the Player screen,
**so that** I can listen at my preferred speed (0.5x to 2x).

## Acceptance Criteria

1. **Speed control UI:** The Player screen displays a playback speed control below the play/pause/skip controls, showing available speed options (0.5x, 0.75x, 1x, 1.25x, 1.5x, 1.75x, 2x).
2. **Speed change works:** Selecting a speed option changes the actual audio playback rate via `react-native-track-player`.
3. **Speed persistence:** The selected speed persists across track changes within the same session (and ideally across app restarts via AsyncStorage).
4. **Default speed:** Default playback speed is 1x.
5. **Visual feedback:** The currently active speed option is visually highlighted.
6. No regression in existing player controls (play/pause, skip forward/back, seek bar).

## Tasks / Subtasks

- [ ] Task 1: Add speed control to playerService (AC: 2, 3, 4)
  - [ ] Add a `setPlaybackSpeed(speed: number)` function to `playerService.ts` that calls `TrackPlayer.setRate(speed)`
  - [ ] Add speed state to `playerSlice.ts` (default: 1.0) with a `setSpeed` action
  - [ ] Store the speed preference in AsyncStorage via `preferencesStorage.ts` so it persists across restarts
  - [ ] When `playBook()` is called, apply the saved speed via `TrackPlayer.setRate()`

- [ ] Task 2: Integrate AudioSpeedControl into PlayerScreen (AC: 1, 5)
  - [ ] Import the existing `AudioSpeedControl` component from `components/AudioSpeedControl.tsx` into `PlayerScreen.tsx`
  - [ ] Connect it to Redux state for `currentSpeed` and dispatch `setSpeed` + call `setPlaybackSpeed()` on change
  - [ ] Place it below the playback controls section (after the `controls` View)
  - [ ] Ensure the speed control is styled consistently with the rest of the Player screen using the `width: '100%'` pattern

- [ ] Task 3: Verify and test (AC: 2, 6)
  - [ ] Test speed changes are audible (playback actually speeds up / slows down)
  - [ ] Test that changing speed mid-playback doesn't reset position
  - [ ] Test all 7 speed options work correctly
  - [ ] Verify existing controls (play/pause, skip, seek) still work at non-1x speeds

## Dev Notes

### Existing Component

An `AudioSpeedControl` component already exists at `GrqaserApp/src/components/AudioSpeedControl.tsx` but is **not imported or used anywhere** in the app. It provides:
- 7 speed options: 0.5x, 0.75x, 1x, 1.25x, 1.5x, 1.75x, 2x
- Props: `currentSpeed: number`, `onSpeedChange: (speed: number) => void`, `disabled?: boolean`
- Uses themed styling with active/inactive states and pill-shaped buttons

### Player Service Gap

`playerService.ts` currently has no speed/rate-related functionality. The `react-native-track-player` library supports `TrackPlayer.setRate(rate: number)` and `TrackPlayer.getRate()` natively — this just needs to be wired up.

### Relevant Source Tree

```
GrqaserApp/src/
├── components/
│   └── AudioSpeedControl.tsx   ← Already exists, unused — integrate into PlayerScreen
├── screens/
│   └── PlayerScreen.tsx        ← Add AudioSpeedControl below controls
├── services/
│   ├── playerService.ts        ← Add setPlaybackSpeed(), apply on playBook()
│   └── preferencesStorage.ts   ← Add speed preference persistence
└── state/slices/
    └── playerSlice.ts          ← Add speed state + setSpeed action
```

### Key Code References

**AudioSpeedControl.tsx** — Complete component ready to use:
```typescript
interface AudioSpeedControlProps {
  currentSpeed: number;
  onSpeedChange: (speed: number) => void;
  disabled?: boolean;
}
const SPEED_OPTIONS = [
  {value: 0.5, label: '0.5x'},
  {value: 0.75, label: '0.75x'},
  {value: 1.0, label: '1x'},
  {value: 1.25, label: '1.25x'},
  {value: 1.5, label: '1.5x'},
  {value: 1.75, label: '1.75x'},
  {value: 2.0, label: '2x'},
];
```

**PlayerScreen.tsx** — line 157–188: The `controls` View where speed control should be placed after:
```typescript
<View style={styles.controls}>
  {/* skip back, play/pause, skip forward */}
</View>
// ← Insert AudioSpeedControl here
```

**playerService.ts** — TrackPlayer is already imported; `setRate()` is available on the `TrackPlayer` API.

### Testing

- Manually test all 7 speed options produce audible changes
- Verify speed persists when navigating away and returning to Player
- Verify speed applies when starting a new book
- Verify skip forward/back and seek work correctly at all speed values

## Change Log

| Date       | Version | Description                         | Author       |
|-----------|---------|-------------------------------------|--------------|
| 2026-02-21 | 1.0     | Story created for bug fixes         | Scrum Master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

_TBD_
