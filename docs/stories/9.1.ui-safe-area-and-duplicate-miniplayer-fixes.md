# Story 9.1: UI Safe Area and Duplicate MiniPlayer Fixes

## Status

Draft

## Story

**As a** mobile user on iOS (notched/Dynamic Island devices),
**I want** all screens to properly respect the safe area insets and see only one mini player bar,
**so that** content is not obscured by the camera/status bar and I don't see duplicate UI elements.

## Acceptance Criteria

1. **Favorites screen safe area:** The Favorites screen adds top safe area padding so the first row of book cards is fully visible below the status bar / Dynamic Island.
2. **Player screen safe area:** The Player screen adds top safe area padding so the book cover, title, and controls do not overlap the status bar / clock / Wi-Fi indicators.
3. **Duplicate MiniPlayer fix:** When a book is playing and the user navigates to the Home tab, only one MiniPlayer bar is visible (not two stacked bars).
4. No regression in other screens' layouts (Home, Library, Profile already handle safe area correctly).

## Tasks / Subtasks

- [ ] Task 1: Fix FavoritesScreen top safe area (AC: 1)
  - [ ] Import `useSafeAreaInsets` from `react-native-safe-area-context` in `FavoritesScreen.tsx`
  - [ ] Add `paddingTop: insets.top + 16` (or similar) to the `content` style or add a header section with safe area padding
  - [ ] For the empty state (`centered` container), also ensure safe area is respected
  - [ ] Verify on a notched device that the first row of book cards is fully visible

- [ ] Task 2: Fix PlayerScreen top safe area (AC: 2)
  - [ ] Import `useSafeAreaInsets` from `react-native-safe-area-context` in `PlayerScreen.tsx`
  - [ ] Add `paddingTop: insets.top + 16` to the `content` style so the cover image starts below the status bar
  - [ ] For the empty state (no book playing), ensure the centered content also respects safe area
  - [ ] Verify on a notched device that title, clock, and Wi-Fi indicators do not overlap the book cover or controls

- [ ] Task 3: Remove duplicate MiniPlayer from HomeScreen (AC: 3)
  - [ ] In `HomeScreen.tsx`, remove the `{currentBook && <MiniPlayer />}` render at line 219 and its associated `MiniPlayer` import (if no longer needed)
  - [ ] The `MiniPlayer` rendered inside `TabNavigator` in `RootNavigator.tsx` (lines 120–128) is the canonical instance — it already handles visibility based on `currentBook` state
  - [ ] Verify only one MiniPlayer bar is visible when a book is playing across all tabs

- [ ] Task 4: Verify no regressions (AC: 4)
  - [ ] Verify Home screen still renders correctly with its existing `useSafeAreaInsets` header
  - [ ] Verify Library screen safe area is not affected
  - [ ] Verify Profile screen safe area is not affected
  - [ ] Verify MiniPlayer navigation (tap to go to Player tab) still works from the single instance

## Dev Notes

### Root Cause Analysis

**Favorites safe area:** `FavoritesScreen.tsx` uses a `ScrollView` with `contentContainerStyle={styles.content}` that only has `padding: theme.spacing.md` (16px uniform). There is no `useSafeAreaInsets` import, so on notched devices the first row of cards is hidden behind the Dynamic Island / notch.

**Player safe area:** `PlayerScreen.tsx` similarly uses `padding: theme.spacing.lg` (24px) with no safe area consideration. The cover image, title, and author text render directly under the status bar elements.

**Duplicate MiniPlayer:** Two separate `<MiniPlayer />` instances are rendered:
1. `RootNavigator.tsx` line 120: Always rendered at the bottom of `TabNavigator`, above the tab bar — this is the canonical instance
2. `HomeScreen.tsx` line 219: Conditionally rendered when `currentBook` exists — this creates a duplicate

### Relevant Source Tree

```
GrqaserApp/src/
├── screens/
│   ├── FavoritesScreen.tsx    ← Add safe area insets
│   ├── PlayerScreen.tsx       ← Add safe area insets
│   └── HomeScreen.tsx         ← Remove duplicate MiniPlayer
├── navigation/
│   └── RootNavigator.tsx      ← Canonical MiniPlayer (no changes)
└── components/
    └── MiniPlayer.tsx         ← No changes needed
```

### Key Code References

**FavoritesScreen.tsx** — lines 60–62: `styles.container` and `styles.content` lack safe area padding:
```typescript
container: {flex: 1, backgroundColor: theme.colors.background},
content: {padding: theme.spacing.md, paddingBottom: 32},
```

**PlayerScreen.tsx** — lines 194–199: `styles.content` lacks safe area padding:
```typescript
content: {
  padding: theme.spacing.lg,
  paddingBottom: 48,
  alignItems: 'center',
},
```

**HomeScreen.tsx** — line 219: Duplicate MiniPlayer render:
```typescript
{currentBook && <MiniPlayer />}
```

**RootNavigator.tsx** — lines 120–128: Canonical MiniPlayer (keep this one):
```typescript
<MiniPlayer
  onPress={() => navigation.navigate('MainTabs', {screen: 'Player'})}
/>
```

### Pattern Reference

Home screen and Library screen already use `useSafeAreaInsets` correctly:
- `HomeScreen.tsx` line 81: `paddingTop: insets.top + 20`
- `LibraryScreen.tsx` line 172: `paddingTop: insets.top + 16`

Follow the same pattern for Favorites and Player screens.

### Testing

- Test on iPhone with Dynamic Island (iPhone 14 Pro / 15 Pro / 16 Pro / 17 Pro) to verify content is not obscured
- Test on older notched iPhones (iPhone 12/13) for notch safe area
- Verify MiniPlayer appears only once across all tabs when a book is playing
- Test MiniPlayer tap navigation still routes to the Player tab

## Change Log

| Date       | Version | Description                         | Author       |
|-----------|---------|-------------------------------------|--------------|
| 2026-02-21 | 1.0     | Story created for bug fixes         | Scrum Master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

_TBD_
