# Story 5.1: Crawler and database-viewer testing

## Status

Draft

## Story

**As a** developer,  
**I want** automated tests for the crawler (parsing, validation, DB writes) and database-viewer (API, optional UI),  
**so that** regressions are caught before release.

## Acceptance Criteria

1. Crawler has unit tests for parsing/normalization and integration tests for DB writes.
2. Database-viewer has tests for main API routes and health.
3. Tests run in a single command (e.g., npm script or CI job).

## Tasks / Subtasks

- [ ] Task 1: Crawler test coverage (AC: 1)
  - [ ] Ensure crawler has unit tests for parsing/normalization and integration tests for DB writes ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [ ] Add or consolidate tests so coverage meets project expectations; no HTML in text fields, required fields validated.
  - [ ] Run: `npm test` from `crawler/` ([Source: docs/architecture/tech-stack.md]).
- [ ] Task 2: Database-viewer test coverage (AC: 2)
  - [ ] Ensure database-viewer has tests for main API routes (books, stats, crawler, health) ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [ ] Add or consolidate tests; optional UI tests if applicable.
  - [ ] Run: `npm test` from `database-viewer/`.
- [ ] Task 3: Single-command and CI (AC: 3)
  - [ ] Single command (e.g. root `npm test` or script) runs crawler and database-viewer tests ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [ ] Document or add CI job so tests run in pipeline; no Phase 2/3 tests assuming incomplete Phase 1/2 data.

## Dev Notes

### Previous Story Insights

Epic 5 follows phase order: crawler first, then viewer, then app. This story focuses on crawler and database-viewer test automation and a single runnable suite.

### File Locations

- **Crawler tests:** `crawler/` (e.g. `__tests__/` or `*.test.js`). **Database-viewer tests:** `database-viewer/` ([Source: docs/architecture/source-tree.md]). **CI:** Root or per-app npm scripts ([Source: docs/architecture/testing-and-deployment-strategy.md]).

### Technical Constraints

- Jest for crawler and viewer ([Source: docs/architecture/tech-stack.md]). Phase 1 and 2 tests must not depend on incomplete phase data ([Source: docs/architecture/testing-and-deployment-strategy.md]).

### Testing

- This story is about adding/consolidating tests; validate by running the single command and confirming coverage expectations.

## Change Log

| Date       | Version | Description                    | Author       |
|-----------|---------|--------------------------------|--------------|
| 2025-02-14 | 1.0     | Story created from Epic 5     | Scrum Master |

## Dev Agent Record

### Agent Model Used

—

### Debug Log References

—

### Completion Notes List

—

### File List

—

## QA Results

—
