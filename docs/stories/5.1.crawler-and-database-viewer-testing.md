# Story 5.1: Books-admin-app testing (crawler + viewer behavior)

## Status

Draft

## Story

**As a** developer,  
**I want** automated tests for books-admin-app covering crawler behavior (parsing, validation, DB writes) and viewer behavior (API, optional UI),  
**so that** regressions are caught before release and we have one test surface for the admin application.

## Acceptance Criteria

1. Books-admin-app’s crawler capability has unit tests for parsing/normalization and integration tests for DB writes (or equivalent coverage via books-admin-app test suite).
2. Books-admin-app has tests for main API routes (books, stats, crawler, health) and health check.
3. Tests run in a single command (e.g., npm script or CI job) for books-admin-app.

## Tasks / Subtasks

- [ ] Task 1: Crawler behavior test coverage in books-admin-app (AC: 1)
  - [ ] Ensure books-admin-app test suite covers crawler behavior: parsing/normalization (crawler package or in-process) and DB writes ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [ ] Add or consolidate tests so coverage meets project expectations; no HTML in text fields, required fields validated.
  - [ ] Run: `npm test` from `books-admin-app/` (and crawler package if tests live there) ([Source: docs/architecture/tech-stack.md]).
- [ ] Task 2: Books-admin-app API and health test coverage (AC: 2)
  - [ ] Ensure books-admin-app has tests for main API routes (books, stats, crawler, health) ([Source: docs/architecture/testing-and-deployment-strategy.md], [Source: docs/prd/epic-5.md]).
  - [ ] Add or consolidate tests; optional UI tests if applicable.
  - [ ] Run: `npm test` from `books-admin-app/`.
- [ ] Task 3: Single-command and CI (AC: 3)
  - [ ] Single command (e.g. `npm test` in books-admin-app or root script) runs books-admin-app tests ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [ ] Document or add CI job so books-admin-app tests run in pipeline; no tests assuming incomplete Epic 6 or Phase 2 data.

## Dev Notes

### Previous Story Insights

Epic 5 verification targets books-admin-app (the merge of crawler and database-viewer). This story focuses on test automation for the single admin application. Standalone crawler and database-viewer are removed in Epic 7.

### File Locations

- **Books-admin-app tests:** `books-admin-app/` (e.g. `tests/*.test.js`). **Crawler logic:** May live in `crawler/` as dependency of books-admin-app until Epic 7 removal ([Source: docs/prd/epic-7.md]). **CI:** Root or books-admin-app npm scripts ([Source: docs/architecture/testing-and-deployment-strategy.md]).

### Technical Constraints

- Jest for books-admin-app ([Source: docs/architecture/tech-stack.md]). Tests must not depend on incomplete Epic 6 or phase data ([Source: docs/architecture/testing-and-deployment-strategy.md]).

### Testing

- This story is about adding/consolidating tests; validate by running the single command and confirming coverage expectations.

## Change Log

| Date       | Version | Description                    | Author       |
|-----------|---------|--------------------------------|--------------|
| 2025-02-14 | 1.0     | Story created from Epic 5     | Scrum Master |

## Dev Agent Record

### Agent Model Used

—

### Debug Log References

—

### Completion Notes List

—

### File List

—

## QA Results

—
