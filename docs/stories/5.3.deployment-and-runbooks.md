# Story 5.3: Deployment and runbooks

## Status

Done

## Story

**As an** operator,  
**I want** clear steps to run books-admin-app and (where applicable) GrqaserApp distribution,  
**so that** the system can be deployed and updated safely.

## Acceptance Criteria

1. Books-admin-app run instructions are documented (port, DB path, env, how to start/stop crawler and use DB versioning per Epic 6).
2. Crawler run is documented as part of books-admin-app (start/stop and config via app per 6.3); no separate standalone crawler runbook.
3. GrqaserApp store submission (or internal distribution) steps and requirements are documented.
4. Known troubleshooting (e.g., from docs/tasks/06-TROUBLESHOOTING.md) is referenced or summarized.

## Tasks / Subtasks

- [x] Task 1: Books-admin-app runbook (AC: 1, 2)
  - [x] Document books-admin-app run instructions: port, DB path, env, logging ([Source: docs/architecture/testing-and-deployment-strategy.md], [Source: docs/prd/epic-6.md]).
  - [x] Document crawler as part of books-admin-app: start/stop and config via app (Story 6.3); no separate crawler runbook ([Source: docs/prd/epic-5.md]).
  - [x] Include how to run full crawl and validate output via books-admin-app ([Source: docs/architecture/crawler-pipeline-and-data-contract.md]).
- [x] Task 2: GrqaserApp distribution (AC: 3)
  - [x] Document GrqaserApp store submission or internal distribution steps and requirements ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [x] Include env and signing requirements ([Source: docs/architecture/testing-and-deployment-strategy.md]).
- [x] Task 3: Troubleshooting (AC: 4)
  - [x] Reference or summarize known troubleshooting (e.g. from `docs/tasks/06-TROUBLESHOOTING.md` or equivalent) ([Source: docs/architecture/testing-and-deployment-strategy.md]).
  - [x] Place in docs or runbook so operators can find it.

## Dev Notes

### Previous Story Insights

Stories 5.1 and 5.2 cover books-admin-app test automation and GrqaserApp builds. This story delivers operator-facing runbooks and deployment docs. Books-admin-app is the single admin app; crawler and database-viewer are not run as separate apps (see Epic 7 for their removal).

### File Locations

- **Runbooks/docs:** `docs/` or per-app README; books-admin-app and GrqaserApp have run instructions ([Source: docs/architecture/testing-and-deployment-strategy.md], [Source: docs/prd/epic-5.md]). **Troubleshooting:** `docs/tasks/06-TROUBLESHOOTING.md` or equivalent if present.

### Technical Constraints

- Config and env documented; no secrets in docs ([Source: docs/architecture/coding-standards.md]).

### Testing

- Validate by following documented steps (crawler run, viewer run, app distribution) and confirming they work.

## Change Log

| Date       | Version | Description                    | Author       |
|-----------|---------|--------------------------------|--------------|
| 2025-02-14 | 1.0     | Story created from Epic 5     | Scrum Master |
| 2025-02-21 | 1.1     | Runbooks added (books-admin-app, GrqaserApp distribution, troubleshooting index) | Dev Agent    |

## Dev Agent Record

### Agent Model Used

—

### Debug Log References

- No automated tests for this story; validation is by following documented steps (per story Testing section). `npm test` in books-admin-app failed in this environment due to better-sqlite3 Node ABI mismatch (NODE_MODULE_VERSION 127 vs 93)—pre-existing environment issue, not caused by story changes (docs only).

### Completion Notes List

- Added books-admin-app runbook: `docs/runbooks/books-admin-app.md` (port, DB path, env, crawler start/stop and config, DB versioning, full crawl and validate). Crawler documented as part of books-admin-app only; no separate crawler runbook.
- Extended `books-admin-app/README.md` with "Running a full crawl and validating output" subsection.
- Added GrqaserApp distribution runbook: `docs/runbooks/grqaserapp-distribution.md` (build, signing, env, TestFlight/App Store, Play internal/direct install).
- Added `docs/runbooks/README.md` as operator index; includes troubleshooting section that references and summarizes `docs/tasks/06-TROUBLESHOOTING.md`.

### File List

- `docs/runbooks/README.md` (new)
- `docs/runbooks/books-admin-app.md` (new)
- `docs/runbooks/grqaserapp-distribution.md` (new)
- `books-admin-app/README.md` (modified: added "Running a full crawl and validating output")

## QA Results

### Review Date: 2026-02-21

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Documentation-only story. **docs/runbooks/README.md** provides an operator index with links to books-admin-app and GrqaserApp runbooks and a Troubleshooting section that references **docs/tasks/06-TROUBLESHOOTING.md** and summarizes areas (data crawling, React Native, audio, performance, dev env, platform-specific, debugging). **docs/runbooks/books-admin-app.md** covers port (3001), DB path and env (PORT, DB_PATH, DB_DATA_ROOT, LOG_LEVEL, NODE_ENV), start/stop app, crawler start/stop and config via app only (no separate crawler runbook), DB versioning (Epic 6), full crawl and validate, Web UI and API, and tests. **docs/runbooks/grqaserapp-distribution.md** covers build from repo, signing and env (iOS/Android), store submission (TestFlight/App Store, Play internal/direct install), and optional CI. **books-admin-app/README.md** was extended with "Running a full crawl and validating output." All content aligns with testing-and-deployment-strategy and coding standards (no secrets in docs).

### Refactoring Performed

None.

### Compliance Check

- Coding Standards: ✓ Config and env documented; no secrets in docs; references to coding standards where relevant.
- Project Structure: ✓ Runbooks under docs/runbooks/; troubleshooting link to docs/tasks/.
- Testing Strategy: ✓ Story validation is by following documented steps; no automated tests required.
- All ACs Met: ✓ AC1 (books-admin-app run instructions), AC2 (crawler as part of app only), AC3 (GrqaserApp distribution), AC4 (troubleshooting referenced and summarized).

### Improvements Checklist

- [x] Runbooks cover all ACs; troubleshooting linked and summarized.

### Security Review

No concerns. Docs advise not putting secrets in env or config; keystore passwords not committed (GrqaserApp runbook).

### Performance Considerations

None for this story.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/5.3-deployment-and-runbooks.yml

### Recommended Status

✓ Ready for Done — All acceptance criteria met; runbooks are complete and discoverable.
