# Story 2.1: Books API and stats API

## Status

Draft

## Story

**As an** operator,  
**I want** a REST API for books (list, by id, search) and stats (overview, authors, categories),  
**so that** I can integrate and debug catalog data programmatically.

## Acceptance Criteria

1. `GET /api/v1/books` returns a list with pagination/filters as needed.
2. `GET /api/v1/books/:id` returns a single book by id.
3. `GET /api/v1/books/search?q=...` returns search results.
4. Stats endpoints (e.g., overview, authors, categories) return counts/aggregates consistent with the schema.

## Tasks / Subtasks

- [ ] Task 1: Books list endpoint (AC: 1)
  - [ ] Implement `GET /api/v1/books` with pagination and filters (e.g. page, limit, category, author) ([Source: docs/architecture/database-viewer-api-and-deployment.md]).
  - [ ] Read from SQLite via database layer; return JSON consistent with data contract ([Source: docs/architecture/data-models-and-schema.md]).
  - [ ] Unit test route; integration test with DB.
- [ ] Task 2: Book by id and search (AC: 2, 3)
  - [ ] Implement `GET /api/v1/books/:id` returning a single book or 404 ([Source: docs/architecture/database-viewer-api-and-deployment.md]).
  - [ ] Implement `GET /api/v1/books/search?q=...` returning search results (title/author/description match).
  - [ ] Unit/integration tests for both.
- [ ] Task 3: Stats endpoints (AC: 4)
  - [ ] Implement stats endpoints (overview, authors, categories) with counts/aggregates consistent with schema ([Source: docs/architecture/database-viewer-api-and-deployment.md], [Source: docs/architecture/data-models-and-schema.md]).
  - [ ] Unit/integration tests for stats responses.

## Dev Notes

### Previous Story Insights

Epic 2 starts only after Epic 1 (crawler) is complete. Assume crawler has produced full catalog with documented schema; database-viewer is read-only.

### Data Models

- **Books** and any category/author tables from crawler schema. API responses align with [Source: docs/architecture/data-models-and-schema.md]. Stats: overview (e.g. total books), authors (counts), categories (counts/aggregates).

### API Specifications

- **Base:** `/api/v1`. **Books:** `GET /api/v1/books`, `GET /api/v1/books/:id`, `GET /api/v1/books/search?q=...`. **Stats:** Overview, authors, categories ([Source: docs/architecture/database-viewer-api-and-deployment.md]).

### File Locations

- **Entry:** `database-viewer/src/server.js`. **Config:** `database-viewer/src/config/config.js`. **Routes:** e.g. `database-viewer/src/routes/books.js`, `stats.js`. **Models:** `database-viewer/src/models/database.js` (SQLite read-only). **API:** under `/api/v1` ([Source: docs/architecture/database-viewer-api-and-deployment.md], [Source: docs/architecture/source-tree.md]).

### Technical Constraints

- Express 4.x; read-only DB access; REST; consistent error formats and HTTP status codes ([Source: docs/architecture/tech-stack.md], [Source: docs/architecture/coding-standards.md]). Config: port, DB path, CORS externalized.

### Testing

- Unit tests for API handlers; integration tests for API + DB ([Source: docs/architecture/testing-and-deployment-strategy.md]). Run: `npm test` from `database-viewer/`.

## Change Log

| Date       | Version | Description                    | Author       |
|-----------|---------|--------------------------------|--------------|
| 2025-02-14 | 1.0     | Story created from Epic 2     | Scrum Master |

## Dev Agent Record

### Agent Model Used

—

### Debug Log References

—

### Completion Notes List

—

### File List

—

## QA Results

—
